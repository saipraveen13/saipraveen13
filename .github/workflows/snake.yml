name: GitHub Snake Game

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  generate:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Generate GitHub Contributions Snake Animations
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/github-snake.svg
            dist/github-snake-dark.svg?palette=github-dark
            dist/ocean.gif?color_snake=orange&color_dots=#bfd6f6,#8dbdff,#64a1f4,#4b91f1,#3c7dd9
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up permissions for dist directory
        run: sudo chmod -R 777 dist

      - name: Add Sparkles and Fireworks Effects
        run: |
          # Create a simple script to add animations using sed
          cat > add_effects.sh << 'EOF'
          #!/bin/bash
          for file in dist/*.svg; do
            if [ -f "$file" ]; then
              # Create a backup
              cp "$file" "$file.bak"
              
              # Add style element with animations
              sed -i '/<\/defs>/a\  <style>\n    @keyframes sparkle { 0%, 100% { opacity: 0; transform: scale(1); } 50% { opacity: 1; transform: scale(1.5); } }\n    @keyframes explode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }\n  </style>' "$file"
              
              # Add sparkles
              sed -i '/<\/style>/a\  <circle cx="50" cy="50" r="2" fill="gold" style="animation: sparkle 2s infinite;"/>\n  <circle cx="70" cy="30" r="2" fill="gold" style="animation: sparkle 2s infinite; animation-delay: 0.5s;"/>\n  <circle cx="90" cy="50" r="2" fill="gold" style="animation: sparkle 2s infinite; animation-delay: 1s;"/>\n  <circle cx="110" cy="30" r="2" fill="gold" style="animation: sparkle 2s infinite; animation-delay: 1.5s;"/>' "$file"
              
              # Add fireworks
              sed -i '/<\/style>/a\  <circle cx="200" cy="100" r="3" fill="red" style="animation: explode 1.5s infinite;"/>\n  <circle cx="250" cy="150" r="3" fill="blue" style="animation: explode 1.5s infinite; animation-delay: 0.5s;"/>\n  <circle cx="300" cy="100" r="3" fill="green" style="animation: explode 1.5s infinite; animation-delay: 1s;"/>' "$file"
              
              echo "Added effects to $file"
            fi
          done
          EOF
          
          # Make the script executable and run it
          chmod +x add_effects.sh
          ./add_effects.sh

      - name: Create HTML showcase
        run: |
          cat > dist/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>GitHub Snake Game with Animations</title>
              <style>
                  body {
                      font-family: Arial, sans-serif;
                      text-align: center;
                      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                      margin: 0;
                      padding: 20px;
                  }
                  .container {
                      max-width: 800px;
                      margin: 0 auto;
                      background: white;
                      padding: 20px;
                      border-radius: 10px;
                      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                  }
                  h1 {
                      color: #333;
                  }
                  .svg-container {
                      margin: 20px 0;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                      padding: 10px;
                      background: white;
                  }
                  .original {
                      opacity: 0.8;
                  }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>GitHub Snake Game with Animations</h1>
                  <p>Your GitHub contribution graph with added sparkles and fireworks!</p>
                  
                  <div class="svg-container">
                      <h2>Light Theme with Animations</h2>
                      <img src="github-snake.svg" alt="Light theme snake with animations" style="max-width: 100%;">
                  </div>
                  
                  <div class="svg-container">
                      <h2>Dark Theme with Animations</h2>
                      <img src="github-snake-dark.svg" alt="Dark theme snake with animations" style="max-width: 100%;">
                  </div>
                  
                  <div class="svg-container original">
                      <h2>Ocean Animation</h2>
                      <img src="ocean.gif" alt="Ocean animation" style="max-width: 100%;">
                  </div>
              </div>
          </body>
          </html>
          EOF

      - name: Deploy to Output Branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: output
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: "Update snake animation with sparkles and fireworks [skip ci]"
